<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic Games Scanner - AI Powered</title>
    <link rel="icon" type="image/png" href="../../favicon.png">

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Crypto JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <style>
        body {
            background-color: #0f172a;
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Animations */
        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse-slow {
            animation: pulse-slow 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Watermark */
        .watermark-container::after {
            content: "© 2025 TecnoIT. Desenvolvido por Marcelo Rodrigues.";
            font-size: 0.65rem;
            color: #475569;
            opacity: 0.5;
            font-weight: 300;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            cursor: default;
            display: block;
            text-align: center;
            margin-top: 1rem;
        }
        body:not(:has(.watermark-container))::after {
            content: "© 2025 TecnoIT. Desenvolvido por Marcelo Rodrigues.";
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: white;
            background: red;
            padding: 10px;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ==========================================
        // WORKER CODE BLOCKS (Blob URLs)
        // ==========================================

        const hashWorkerCode = `
            importScripts('https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js');

            self.addEventListener('message', async (event) => {
                const { type, data, id } = event.data;

                switch (type) {
                    case 'CALCULATE_HASH':
                        try {
                            const dataString = typeof data === 'string' ? data : JSON.stringify(data);

                            // Simple JS implementation for workers without SubtleCrypto easy access in all envs
                            const sha256 = CryptoJS.SHA256(dataString).toString();
                            const md5 = CryptoJS.MD5(dataString).toString();

                            self.postMessage({
                                type: 'HASH_RESULT',
                                id,
                                result: { sha256, md5, timestamp: Date.now() }
                            });
                        } catch (error) {
                            self.postMessage({ type: 'HASH_ERROR', id, error: error.message });
                        }
                        break;
                }
            });
        `;

        const hashWorkerBlob = new Blob([hashWorkerCode], { type: 'application/javascript' });
        const hashWorkerUrl = URL.createObjectURL(hashWorkerBlob);

        // ==========================================
        // UTILS & HELPERS
        // ==========================================

        const SYSTEM_CONFIG = {
            MODES: {
                NINJA: { refresh: 5000, workers: 4, depth: 'DEEP' }, // Faster for demo
                STEALTH: { refresh: 10000, workers: 4, depth: 'NORMAL' },
                PASSIVE: { refresh: 30000, workers: 2, depth: 'LIGHT' }
            },
            ENDPOINTS: [
                'https://store-site-backend-static.ak.epicgames.com/freeGamesPromotions',
            ],
            PROXIES: [
                { name: 'AllOrigins', url: (t) => `https://api.allorigins.win/raw?url=${encodeURIComponent(t)}` },
                { name: 'CorsProxy', url: (t) => `https://corsproxy.io/?${encodeURIComponent(t)}` }
            ],
            PATTERNS: {
                MYSTERY_INDICATORS: [
                    'mystery', 'secret', 'hidden', 'coming_soon', 'placeholder',
                    'upcoming', 'unannounced', 'TBA', 'TBD', '???', 'confidential'
                ]
            }
        };

        // Icon Component Map (Lucide -> FontAwesome)
        const Icon = ({ name, size = 16, className = '' }) => {
            const map = {
                Activity: 'fa-chart-line',
                ShieldCheck: 'fa-user-shield',
                Radio: 'fa-broadcast-tower',
                CheckCircle: 'fa-circle-check',
                Fingerprint: 'fa-fingerprint',
                Lock: 'fa-lock',
                Zap: 'fa-bolt',
                Terminal: 'fa-terminal',
                AlertTriangle: 'fa-triangle-exclamation',
                Database: 'fa-database',
                Cpu: 'fa-microchip',
                Globe: 'fa-globe',
                Server: 'fa-server',
                Network: 'fa-network-wired',
                BarChart3: 'fa-chart-bar',
                Eye: 'fa-eye',
                Siren: 'fa-bell', // 'fa-bullhorn'
                FileSearch: 'fa-magnifying-glass',
                Binary: 'fa-file-code',
                Layers: 'fa-layer-group',
                Ghost: 'fa-ghost',
                Gamepad2: 'fa-gamepad'
            };

            const faClass = map[name] || 'fa-question';
            // Rough size conversion: 16px -> 1rem?
            // Tailwind text size classes: text-sm (14px), text-base (16px), text-lg (18px)
            const sizeClass = size <= 16 ? 'text-sm' : size <= 20 ? 'text-base' : 'text-xl';

            return <i className={`fa-solid ${faClass} ${sizeClass} ${className}`}></i>;
        };


        // ==========================================
        // MODULES (CLASSES)
        // ==========================================

        class PatternMatcher {
            async loadPatterns() { return true; }
            match(data) { return false; } // Simplified
        }

        class ScannerEngine {
            constructor(config) {
                this.config = config;
                this.history = [];
                this.cache = { responses: new Map(), hashes: new Map() };
                this.patternMatcher = new PatternMatcher();
                this.worker = new Worker(hashWorkerUrl);
                this.init();
            }

            async init() {
                await this.patternMatcher.loadPatterns();
                this.worker.onmessage = (e) => {
                    // Handle async hash results if needed
                };
            }

            async deepScan() {
                const results = { current: [], upcoming: [], mystery: [], anomalies: [] };

                // Fetch Data
                const endpoint = this.config.ENDPOINTS[0];
                try {
                    const data = await this.fetchWithProxy(endpoint);
                    if (data) {
                        this.processStoreData(data, results);
                    }
                } catch (e) {
                    console.error("DeepScan Error:", e);
                }

                return results;
            }

            async fetchWithProxy(url) {
                // Try proxies sequentially
                for (const proxy of this.config.PROXIES) {
                    try {
                        const targetUrl = proxy.url(url);
                        const response = await fetch(targetUrl);
                        if (!response.ok) throw new Error(`HTTP ${response.status}`);
                        return await response.json();
                    } catch (err) {
                        console.warn(`Proxy ${proxy.name} failed:`, err);
                        continue;
                    }
                }
                throw new Error("All proxies failed");
            }

            processStoreData(data, results) {
                // Epic Games Store Data Parsing
                const elements = data?.data?.Catalog?.searchStore?.elements;
                if (!elements) return;

                elements.forEach(game => {
                    // Current Free Games
                    const promotions = game.promotions;

                    const currentOffers = promotions?.promotionalOffers?.[0]?.promotionalOffers || [];
                    currentOffers.forEach(offer => {
                        if (offer.discountSetting?.discountPercentage === 0) {
                            results.current.push({ ...game, offerDetails: offer });
                        }
                    });

                    // Upcoming Free Games
                    const upcomingOffers = promotions?.upcomingPromotionalOffers?.[0]?.promotionalOffers || [];
                    upcomingOffers.forEach(offer => {
                         const gameObj = { ...game, offerDetails: offer };
                         const title = (game.title || '').toLowerCase();

                         if (this.config.PATTERNS.MYSTERY_INDICATORS.some(i => title.includes(i))) {
                             results.mystery.push(gameObj);
                             results.anomalies.push({ type: 'MYSTERY_DETECTED', game: gameObj });
                         } else {
                             results.upcoming.push(gameObj);
                         }
                    });
                });
            }

            detectChanges(data) { return []; } // Simplified
            detectAnomalies(data) { return data.anomalies || []; }
            async fingerprintScan() { return []; }
            async artifactScan() { return []; }
        }

        class PredictorEngine {
            async loadHistoricalData() { return true; }
            async analyzePatterns() { return []; }
        }

        class IntelligenceCollector {
            async initialize() { return true; }
            async collectIntelligence() {
                return { leaks: [], correlations: [], sources: [] };
            }
        }

        // ==========================================
        // REACT COMPONENTS
        // ==========================================

        const Header = ({ systemState, metrics, onModeChange }) => (
            <header className="bg-slate-900/50 backdrop-blur border-b border-slate-800 sticky top-0 z-50">
                <div className="container mx-auto px-4 h-16 flex items-center justify-between">
                    <div className="flex items-center gap-4">
                        <div className="w-10 h-10 rounded bg-indigo-600 flex items-center justify-center shadow-lg shadow-indigo-500/20">
                            <Icon name="Ghost" className="text-white text-xl" />
                        </div>
                        <div>
                            <h1 className="font-bold text-lg text-white tracking-tight">EPIC SCANNER <span className="text-indigo-400">PRO</span></h1>
                            <div className="flex items-center gap-2 text-xs text-slate-400 font-mono">
                                <span className={`w-2 h-2 rounded-full ${systemState.status === 'OPERATIONAL' ? 'bg-green-500 animate-pulse' : 'bg-yellow-500'}`}></span>
                                {systemState.status}
                            </div>
                        </div>
                    </div>

                    <div className="flex items-center gap-4">
                        <div className="flex bg-slate-800 rounded-lg p-1">
                            {['NINJA', 'STEALTH', 'PASSIVE'].map(mode => (
                                <button
                                    key={mode}
                                    onClick={() => onModeChange(mode)}
                                    className={`px-3 py-1 text-xs font-bold rounded transition-all ${
                                        systemState.mode === mode
                                        ? 'bg-indigo-600 text-white shadow'
                                        : 'text-slate-400 hover:text-white'
                                    }`}
                                >
                                    {mode}
                                </button>
                            ))}
                        </div>
                        <a href="../../index.html" className="text-slate-400 hover:text-white transition-colors">
                            <i className="fa-solid fa-xmark text-xl"></i>
                        </a>
                    </div>
                </div>
            </header>
        );

        const MetricsCard = ({ title, value, icon, trend }) => (
            <div className="bg-slate-800/40 border border-slate-700/50 rounded-xl p-4 backdrop-blur-sm hover:border-indigo-500/30 transition-all group">
                <div className="flex justify-between items-start mb-2">
                    <span className="text-slate-400 text-xs font-bold uppercase tracking-wider">{title}</span>
                    <div className={`p-2 rounded-lg ${
                        trend === 'positive' ? 'bg-green-500/10 text-green-400' :
                        trend === 'negative' ? 'bg-red-500/10 text-red-400' :
                        'bg-yellow-500/10 text-yellow-400'
                    }`}>
                        <Icon name={icon} size={16} />
                    </div>
                </div>
                <div className="text-2xl font-mono font-bold text-white group-hover:text-indigo-400 transition-colors">
                    {value}
                </div>
            </div>
        );

        const GameCard = ({ game, type }) => {
            const image = game.keyImages?.find(i => i.type === 'Thumbnail' || i.type === 'OfferImageWide')?.url
                          || 'https://via.placeholder.com/300x169?text=No+Image';

            const isMystery = type === 'mystery';

            return (
                <div className="bg-slate-800 rounded-xl overflow-hidden border border-slate-700 hover:border-indigo-500 transition-all group relative">
                    {isMystery && (
                        <div className="absolute inset-0 bg-slate-900/90 z-10 flex items-center justify-center backdrop-blur-sm">
                            <div className="text-center">
                                <Icon name="Lock" className="text-4xl text-yellow-500 mb-2 animate-bounce" />
                                <h4 className="font-bold text-yellow-400">MISTÉRIO DETECTADO</h4>
                            </div>
                        </div>
                    )}
                    <div className="aspect-video relative">
                        <img src={image} alt={game.title} className="w-full h-full object-cover" />
                        <div className="absolute bottom-0 left-0 w-full bg-gradient-to-t from-slate-900 to-transparent p-4 pt-12">
                            <h3 className="font-bold text-white text-lg leading-tight">{game.title}</h3>
                        </div>
                    </div>
                    <div className="p-4 space-y-3">
                        <p className="text-xs text-slate-400 line-clamp-2">{game.description}</p>
                        <div className="flex justify-between items-center text-xs">
                            <span className="px-2 py-1 rounded bg-green-500/20 text-green-400 font-bold">GRÁTIS</span>
                            <span className="text-slate-500 font-mono">
                                {new Date(game.offerDetails?.startDate || Date.now()).toLocaleDateString()}
                            </span>
                        </div>
                    </div>
                </div>
            );
        };

        const LogsPanel = ({ logs }) => (
            <div className="bg-slate-900 border border-slate-800 rounded-xl p-4 h-64 overflow-hidden flex flex-col font-mono text-xs">
                <div className="flex items-center gap-2 mb-3 text-slate-400 uppercase font-bold tracking-wider text-[10px] border-b border-slate-800 pb-2">
                    <Icon name="Terminal" size={12} />
                    System Logs
                </div>
                <div className="overflow-y-auto flex-1 space-y-1 custom-scrollbar">
                    {logs.map((log) => (
                        <div key={log.id} className="flex gap-2">
                            <span className="text-slate-600">[{log.timestamp.split('T')[1].split('.')[0]}]</span>
                            <span className={`font-bold ${
                                log.type === 'ERROR' ? 'text-red-500' :
                                log.type === 'SUCCESS' ? 'text-green-500' :
                                log.type === 'WARNING' ? 'text-yellow-500' :
                                'text-blue-400'
                            }`}>{log.type}</span>
                            <span className="text-slate-300">{log.message}</span>
                        </div>
                    ))}
                </div>
            </div>
        );

        // ==========================================
        // MAIN APP COMPONENT
        // ==========================================

        function App() {
            const [systemState, setSystemState] = React.useState({
                mode: 'NINJA',
                status: 'INITIALIZING',
                scanCount: 0
            });

            const [data, setData] = React.useState({
                currentGames: [],
                upcomingGames: [],
                mysteryGames: [],
                anomalies: []
            });

            const [metrics, setMetrics] = React.useState({
                responseTime: 0,
                successRate: 100,
                hashChanges: 0,
                silenceDuration: 0
            });

            const [logs, setLogs] = React.useState([]);

            // Refs for Engines
            const scannerRef = React.useRef(null);
            const predictorRef = React.useRef(new PredictorEngine());
            const intelRef = React.useRef(new IntelligenceCollector());

            // Logger
            const addLog = React.useCallback((message, type = 'INFO') => {
                const log = {
                    id: Math.random().toString(36).substr(2, 9),
                    timestamp: new Date().toISOString(),
                    type,
                    message
                };
                setLogs(prev => [log, ...prev].slice(0, 50));
            }, []);

            // Init
            React.useEffect(() => {
                const init = async () => {
                    addLog('Inicializando Sistema de Scanner EPIC...', 'SYSTEM');

                    try {
                        scannerRef.current = new ScannerEngine(SYSTEM_CONFIG);
                        await scannerRef.current.init();
                        addLog('Engine de Rede Inicializada', 'SUCCESS');

                        setSystemState(prev => ({ ...prev, status: 'OPERATIONAL' }));
                        executeScan(); // Initial scan
                    } catch (e) {
                        addLog(`Falha Crítica: ${e.message}`, 'ERROR');
                        setSystemState(prev => ({ ...prev, status: 'ERROR' }));
                    }
                };
                init();
            }, []);

            // Scan Cycle
            const executeScan = React.useCallback(async () => {
                if (!scannerRef.current) return;

                setSystemState(prev => ({ ...prev, status: 'SCANNING', scanCount: prev.scanCount + 1 }));
                const start = Date.now();

                try {
                    const scanResults = await scannerRef.current.deepScan();

                    setData(prev => ({
                        currentGames: scanResults.current,
                        upcomingGames: scanResults.upcoming,
                        mysteryGames: scanResults.mystery,
                        anomalies: scanResults.anomalies
                    }));

                    const duration = Date.now() - start;
                    setMetrics(prev => ({
                        ...prev,
                        responseTime: duration,
                        successRate: 100
                    }));

                    addLog(`Varredura concluída em ${duration}ms. ${scanResults.current.length} jogos encontrados.`, 'SUCCESS');

                } catch (e) {
                    addLog(`Erro na varredura: ${e.message}`, 'ERROR');
                } finally {
                    setSystemState(prev => ({ ...prev, status: 'OPERATIONAL' }));
                }
            }, [addLog]);

            // Interval
            React.useEffect(() => {
                if (systemState.status === 'ERROR') return;

                const intervalTime = SYSTEM_CONFIG.MODES[systemState.mode].refresh;
                const interval = setInterval(executeScan, intervalTime);
                return () => clearInterval(interval);
            }, [systemState.mode, systemState.status, executeScan]);

            return (
                <div className="min-h-screen pb-10">
                    <Header
                        systemState={systemState}
                        metrics={metrics}
                        onModeChange={(mode) => setSystemState(prev => ({ ...prev, mode }))}
                    />

                    <main className="container mx-auto px-4 py-6 space-y-6">

                        {/* Metrics Grid */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <MetricsCard
                                title="Tempo Resposta"
                                value={`${metrics.responseTime}ms`}
                                icon="Activity"
                                trend={metrics.responseTime < 1000 ? 'positive' : 'neutral'}
                            />
                            <MetricsCard
                                title="Jogos Ativos"
                                value={data.currentGames.length}
                                icon="Gamepad2"
                                trend="positive"
                            />
                            <MetricsCard
                                title="Próximos"
                                value={data.upcomingGames.length}
                                icon="Calendar"
                                trend="neutral"
                            />
                            <MetricsCard
                                title="Anomalias"
                                value={data.anomalies.length}
                                icon="AlertTriangle"
                                trend={data.anomalies.length > 0 ? 'warning' : 'positive'}
                            />
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-8">

                                {data.currentGames.length > 0 && (
                                    <section>
                                        <h2 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                            <Icon name="CheckCircle" className="text-green-500" />
                                            Disponíveis Agora
                                        </h2>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {data.currentGames.map((game, i) => (
                                                <GameCard key={i} game={game} type="current" />
                                            ))}
                                        </div>
                                    </section>
                                )}

                                {data.upcomingGames.length > 0 && (
                                    <section>
                                        <h2 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                            <Icon name="Clock" className="text-blue-500" />
                                            Em Breve
                                        </h2>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {data.upcomingGames.map((game, i) => (
                                                <GameCard key={i} game={game} type="upcoming" />
                                            ))}
                                        </div>
                                    </section>
                                )}
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                <LogsPanel logs={logs} />

                                <div className="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                                    <h3 className="font-bold text-white mb-2 flex items-center gap-2">
                                        <Icon name="Brain" className="text-purple-500" />
                                        IA Prediction
                                    </h3>
                                    <div className="text-center py-8 text-slate-500 text-sm">
                                        <p>Coletando dados históricos...</p>
                                        <div className="mt-2 w-full bg-slate-700 h-1 rounded overflow-hidden">
                                            <div className="bg-purple-500 h-full w-1/3 animate-pulse"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </main>

                    <footer className="mt-8 text-center relative z-50">
                        <div className="watermark-container"></div>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>